from reportlab.lib.pagesizes import A4
from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle
from reportlab.lib import colors
from reportlab.lib.units import inch

# File path
file_path_part2 = "/mnt/data/Part2_Funnel_Debugging_via_Prompt_Based_Diagnosis.pdf"

# Create PDF
doc = SimpleDocTemplate(file_path_part2, pagesize=A4, title="Part 2 - Funnel Debugging via Prompt-Based Diagnosis")
styles = getSampleStyleSheet()
styles.add(ParagraphStyle(name="Heading", fontSize=14, leading=16, spaceAfter=10, bold=True))
styles.add(ParagraphStyle(name="SubHeading", fontSize=12, leading=14, spaceAfter=8, textColor="#333333"))
styles.add(ParagraphStyle(name="Body", fontSize=10, leading=13))

story = []

# Title
story.append(Paragraph("Part 2: Funnel Debugging via Prompt-Based Diagnosis", styles["Heading"]))
story.append(Spacer(1, 0.2 * inch))

# Mock Funnel Dataset
story.append(Paragraph("Mock Funnel Dataset (Simulated Data)", styles["SubHeading"]))
funnel_data = [
    ["Campaign", "Stage Movement", "Response Rate (%)", "Drop-off Reason", "Campaign Message Summary"],
    ["Pharma-Supply-Intel", "Lead → MQL → SQL → Client", "62 → 48 → 15 → 8", "Trust gap at SQL", "Focused on compliance features, lacked case proof"],
    ["D2C-Commerce-AI", "Lead → MQL → SQL → Client", "75 → 52 → 10 → 5", "Overly technical", "Emphasized architecture over benefits"],
    ["Infra-TrackPro", "Lead → MQL → SQL → Client", "80 → 35 → 30 → 12", "Weak CTA", "Highlighted problems well but ended passively"]
]
t = Table(funnel_data, repeatRows=1)
t.setStyle(TableStyle([
    ('BACKGROUND', (0,0), (-1,0), colors.HexColor('#d3d3d3')),
    ('GRID', (0,0), (-1,-1), 0.5, colors.black),
    ('FONTNAME', (0,0), (-1,0), 'Helvetica-Bold'),
]))
story.append(t)
story.append(Spacer(1, 0.2 * inch))

# MMF Classification
story.append(Paragraph("Step 1: Message–Market Fit (MMF) Classification", styles["SubHeading"]))
mmf_text = """
Pharma-Supply-Intel → High MQL, Low SQL → Misfit in trust-building.
D2C-Commerce-AI → High Lead gen, Low Engagement → Headline / clarity issue.
Infra-TrackPro → Decent SQL, Low Client conversion → CTA weakness.
"""
story.append(Paragraph(mmf_text, styles["Body"]))
story.append(Spacer(1, 0.2 * inch))

# Layer of Failure Diagnosis
story.append(Paragraph("Step 2: Layer of Failure Diagnosis", styles["SubHeading"]))
failure_text = """
Pharma-Supply-Intel → Lack of Context → Compliance claims felt unverified; missing authority anchors.
D2C-Commerce-AI → Wrong Tone → Over-engineered with tech jargon; failed to resonate with marketing-focused CTOs.
Infra-TrackPro → Weak CTA → Did not specify time-bound or value-driven next step.
"""
story.append(Paragraph(failure_text, styles["Body"]))
story.append(Spacer(1, 0.2 * inch))

# Revised Prompts
story.append(Paragraph("Step 3: Revised Prompts to Fix Failures", styles["SubHeading"]))
prompts_text = """
1️⃣ Pharma-Supply-Intel (COO Pharma) – Conviction Stage, Authority + Social Proof
Revised Prompt: Reference audited client outcomes (e.g., "Validated by WHO-compliant audits, Medora Labs cut reporting delays by 40%").
Justification: Anchors trust at SQL level using verified case studies.

2️⃣ D2C-Commerce-AI (CTO D2C) – Interest Stage, Reciprocity + Liking
Revised Prompt: Simplify tone, lead with shared industry pain (e.g., "Every D2C CTO faces this Q4 crunch..."). Offer free forecast simulation.
Justification: Builds engagement and empathy, fixes low Interest.

3️⃣ Infra-TrackPro (Construction COO) – Action Stage, Scarcity + Commitment
Revised Prompt: Add urgency and specificity (e.g., "Early-access slots remaining: 5"). CTA: suggest exact meeting times.
Justification: Increases SQL → Client conversions via urgency and commitment framing.
"""
story.append(Paragraph(prompts_text, styles["Body"]))
story.append(Spacer(1, 0.2 * inch))

# Summary Table
story.append(Paragraph("Summary Dashboard Insight", styles["SubHeading"]))
summary_data = [
    ["Funnel Weakness", "AIDCA Stage Impacted", "Recommended Fix", "Executive Priority"],
    ["Trust Gap", "Conviction", "Case studies + authority proof", "High"],
    ["Low Engagement", "Interest", "Relatable tone + reciprocity", "Medium"],
    ["Weak CTA", "Action", "Urgency + commitment framing", "High"]
]
t2 = Table(summary_data, repeatRows=1)
t2.setStyle(TableStyle([
    ('BACKGROUND', (0,0), (-1,0), colors.HexColor('#d3d3d3')),
    ('GRID', (0,0), (-1,-1), 0.5, colors.black),
    ('FONTNAME', (0,0), (-1,0), 'Helvetica-Bold'),
]))
story.append(t2)

# Save PDF
doc.build(story)
file_path_part2
